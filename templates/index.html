<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Goldfish Vision Lab | YOLOv8 Pose Analytics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg-body-tertiary">
<div class="container-fluid">
  <div class="row min-vh-100">

    <!-- Sidebar -->
    <aside class="col-md-3 col-lg-2 bg-primary text-white d-flex flex-column p-4 shadow-sm">
      <div class="d-flex align-items-center mb-4">
        <div class="rounded-circle bg-white text-primary d-flex align-items-center justify-content-center me-2" style="width:40px;height:40px;">
          <i class="fa-solid fa-fish-fins"></i>
        </div>
        <div>
          <h5 class="mb-0 fw-bold">Goldfish Vision Lab</h5>
          <small class="text-light">YOLOv8 Pose Analytics</small>
        </div>
      </div>

      <nav class="nav flex-column small">
        <span class="text-uppercase text-light fw-semibold mb-2">Menu</span>
        <a class="nav-link text-white-50" href="#"><i class="fa-solid fa-video me-2"></i>Analisis Video</a>
        <a class="nav-link text-white-50" href="#"><i class="fa-solid fa-chart-line me-2"></i>Statistik</a>
        <a class="nav-link text-white-50" href="#"><i class="fa-solid fa-gear me-2"></i>Konfigurasi</a>
      </nav>

      <div class="mt-auto small text-white-50">
        <hr class="border-light border-opacity-25">
        <div><i class="fa-regular fa-circle-dot me-1 text-success"></i> Status: <span class="text-success">Model siap</span></div>
        <div><i class="fa-solid fa-microchip me-1"></i> Engine: YOLOv8 Pose</div>
      </div>
    </aside>

    <!-- Main content -->
    <main class="col-md-9 col-lg-10 p-4 p-lg-5">
      <div class="d-flex flex-wrap align-items-center justify-content-between mb-4">
        <div>
          <h2 class="fw-bold mb-1">Analisis Panjang & Jumlah Ikan</h2>
          <p class="text-muted mb-0">Unggah atau pilih video, lalu jalankan <span class="fw-semibold">Cek Ikan</span> untuk mendapatkan panjang ikan dan jumlah ikan secara otomatis.</p>
        </div>
      </div>

      <div class="row g-4">
        <!-- Panel input -->
        <div class="col-lg-5">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0 pb-0">
              <h5 class="card-title mb-1"><i class="fa-solid fa-cloud-arrow-up me-2 text-primary"></i>Input Video</h5>
              <p class="text-muted small mb-0">Gunakan video dari Google Drive (folder <code>videos</code>) atau unggah berkas baru.</p>
            </div>
            <div class="card-body">
              <form method="post" action="{{ url_for('process') }}" enctype="multipart/form-data">

                <!-- Pilih dari Drive -->
                <div class="mb-3">
                  <label class="form-label fw-semibold">Pilih dari Google Drive</label>
                  <select class="form-select" name="selected_video">
                    <option value="">— Pilih video di folder videos —</option>
                    {% for v in videos %}
                      <option value="{{ v }}" {% if selected_video==v %}selected{% endif %}>{{ v }}</option>
                    {% endfor %}
                  </select>
                  <div class="form-text small">Folder fisik: <code>{{ "/videos" }}</code> (di-mount ke Google Drive).</div>
                </div>

                <div class="text-center my-2 text-muted small">atau</div>

                <!-- Upload baru -->
                <div class="mb-3">
                  <label class="form-label fw-semibold">Upload video baru</label>
                  <input class="form-control" type="file" name="uploaded_video" accept="video/*">
                  <div class="form-text small">Format disarankan: MP4, durasi tidak terlalu panjang.</div>
                </div>

                <button type="submit" class="btn btn-primary w-100 mt-2">
                  <i class="fa-solid fa-magnifying-glass-chart me-2"></i>Cek Ikan
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Panel hasil -->
        <div class="col-lg-7">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0 pb-0 d-flex justify-content-between align-items-center">
              <div>
                <h5 class="card-title mb-1"><i class="fa-solid fa-gauge-high me-2 text-primary"></i>Hasil Analisis</h5>
                <p class="text-muted small mb-0">Ringkasan panjang ikan dan estimasi jumlah ikan.</p>
              </div>
            </div>

            <div class="card-body">
              {% if result %}
                <div class="row g-3 mb-3">
                  <div class="col-md-4">
                    <div class="stat-card border rounded-3 p-3 h-100">
                      <div class="text-uppercase small text-muted">Jumlah Ikan</div>
                      <div class="fw-bold fs-4">{{ result.summary.estimated_fish_count or 0 }}</div>
                      <div class="small text-muted">Estimasi dari modus deteksi per frame</div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="stat-card border rounded-3 p-3 h-100">
                      <div class="text-uppercase small text-muted">Ikan A (besar)</div>
                      <div class="fw-bold fs-4">
                        {% if result.summary.fish_A_cm %}
                          {{ "%.1f"|format(result.summary.fish_A_cm) }} <span class="fs-6">cm</span>
                        {% else %}—{% endif %}
                      </div>
                      <div class="small text-muted">Panjang maksimum terdeteksi</div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="stat-card border rounded-3 p-3 h-100">
                      <div class="text-uppercase small text-muted">Ikan B (kecil)</div>
                      <div class="fw-bold fs-4">
                        {% if result.summary.fish_B_cm %}
                          {{ "%.1f"|format(result.summary.fish_B_cm) }} <span class="fs-6">cm</span>
                        {% else %}—{% endif %}
                      </div>
                      <div class="small text-muted">Panjang minimum terdeteksi</div>
                    </div>
                  </div>
                </div>

                <hr>

                <div class="row g-3">
                  <div class="col-md-6">
                    <h6 class="fw-semibold mb-2">Statistik Panjang Ikan</h6>
                    <ul class="list-unstyled small mb-0">
                      <li><i class="fa-solid fa-circle-small text-primary me-2"></i>Rata-rata:
                        {% if result.summary.mean_length_cm %}
                          {{ "%.2f"|format(result.summary.mean_length_cm) }} cm
                        {% else %}—{% endif %}
                      </li>
                      <li><i class="fa-solid fa-circle-small text-primary me-2"></i>Minimum:
                        {% if result.summary.min_length_cm %}
                          {{ "%.2f"|format(result.summary.min_length_cm) }} cm
                        {% else %}—{% endif %}
                      </li>
                      <li><i class="fa-solid fa-circle-small text-primary me-2"></i>Maksimum:
                        {% if result.summary.max_length_cm %}
                          {{ "%.2f"|format(result.summary.max_length_cm) }} cm
                        {% else %}—{% endif %}
                      </li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <h6 class="fw-semibold mb-2">Video Hasil Anotasi</h6>
                    {% if result.output_video_name %}
                      <video class="w-100 rounded-3 border" controls>
                        <source src="{{ '/outputs/' + result.output_video_name }}" type="video/mp4">
                        Browser Anda tidak mendukung pemutaran video.
                      </video>
                      <p class="small text-muted mt-1 mb-0">File: {{ result.output_video_name }}</p>
                    {% else %}
                      <p class="text-muted small mb-0">Belum ada video hasil analisis.</p>
                    {% endif %}
                  </div>
                </div>
              {% else %}
                <div class="text-center text-muted py-5">
                  <i class="fa-regular fa-circle-play fa-3x mb-3"></i>
                  <p class="mb-1">Belum ada analisis yang dijalankan.</p>
                  <p class="small mb-0">Silakan pilih atau unggah video, lalu tekan tombol <strong>Cek Ikan</strong>.</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
